name: Test ClubZap Automation

on:
  workflow_dispatch:
    inputs:
      step:
        description: 'Test step to run'
        required: true
        type: choice
        options:
          - '1-add-fake'
          - '2-edit-fake'
          - '3-remove-fake'

jobs:
  test-clubzap:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium

      - name: "Step 1: Add fake fixture"
        if: ${{ github.event.inputs.step == '1-add-fake' }}
        run: |
          cat > clubzap_new_fixtures.csv << 'EOF'
          Date,Time,Venue,Ground,Referee,Team,Competition Name,Your Club Name,Opponent,Event Type
          30/09/2026,19:00,Ballincollig,Home,TBC (Pending),Senior Football,TEST AUTOMATION,Ballincollig,AUTOMATION TEST TEAM,League
          EOF
          python clubzap_automate.py upload
        env:
          CLUBZAP_EMAIL: ${{ secrets.CLUBZAP_EMAIL }}
          CLUBZAP_PASSWORD: ${{ secrets.CLUBZAP_PASSWORD }}

      - name: "Step 2: Edit fake fixture"
        if: ${{ github.event.inputs.step == '2-edit-fake' }}
        run: |
          cat > clubzap_changed_fixtures.csv << 'EOF'
          Date,Time,Venue,Ground,Referee,Team,Competition Name,Your Club Name,Opponent,Event Type,Changes
          30/09/2026,20:00,Pairc Ui Rinn,Away,John Smith,Senior Football,TEST AUTOMATION,Ballincollig,AUTOMATION TEST TEAM,League,Time: '19:00' -> '20:00'; Venue: 'Ballincollig' -> 'Pairc Ui Rinn'; Referee: 'TBC (Pending)' -> 'John Smith'
          EOF
          python clubzap_automate.py edit
        env:
          CLUBZAP_EMAIL: ${{ secrets.CLUBZAP_EMAIL }}
          CLUBZAP_PASSWORD: ${{ secrets.CLUBZAP_PASSWORD }}

      - name: "Step 3: Remove fake fixture"
        if: ${{ github.event.inputs.step == '3-remove-fake' }}
        run: |
          cat > clubzap_removed_fixtures.csv << 'EOF'
          Date,Time,Venue,Ground,Referee,Team,Competition Name,Your Club Name,Opponent,Event Type
          30/09/2026,20:00,Pairc Ui Rinn,Away,John Smith,Senior Football,TEST AUTOMATION,Ballincollig,AUTOMATION TEST TEAM,League
          EOF
          python clubzap_automate.py delete
        env:
          CLUBZAP_EMAIL: ${{ secrets.CLUBZAP_EMAIL }}
          CLUBZAP_PASSWORD: ${{ secrets.CLUBZAP_PASSWORD }}
